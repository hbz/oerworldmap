{{#if permissions.add}}

    <div data-dont-behave>

        <form id="form-resource-add-service" method="post" class="clearfix visible-modal" action="/resource/">

            <div class="modal-title">
                <h1>{{stringFormat (i18n "add") (i18n "Service")}}</h1>
                <div class="right">
                    <a href="https://github.com/hbz/oerworldmap/wiki/FAQs-for-OER-World-Map-editors" target="_blank">{{i18n "needHelp"}}</a>
                </div>
            </div>

            <div class="messages resource-form-widget"></div>

            {{> ResourceIndex/Service/edit.mustache}}

            <div class="alert alert-info clearfix">
                <p>
                    {{{i18n "ResourceIndex.index.agreeMessage"}}}
                </p>
                <div class="pull-right">
                    <button type="button" class="btn btn-default" data-dismiss="modal">{{i18n "cancel"}}</button>
                    <button type="submit" class="btn btn-inverted">{{i18n "publish"}}</button>
                </div>
            </div>
        </form>


        <form id="form-resource-add-organization" method="post" class="clearfix visible-modal" action="/resource/">

            <div class="modal-title">
                <h1>{{stringFormat (i18n "add") (i18n "Organization")}}</h1>
                <div class="right">
                    <a href="https://github.com/hbz/oerworldmap/wiki/FAQs-for-OER-World-Map-editors" target="_blank">{{i18n "needHelp"}}</a>
                </div>
            </div>

            <div class="messages resource-form-widget"></div>

            {{> ResourceIndex/Organization/edit.mustache}}

            <div class="alert alert-info clearfix">
                <p>
                    {{{i18n "ResourceIndex.index.agreeMessage"}}}
                </p>
                <div class="pull-right">
                    <button type="button" class="btn btn-default" data-dismiss="modal">{{i18n "cancel"}}</button>
                    <button type="submit" class="btn btn-inverted">{{i18n "publish"}}</button>
                </div>
            </div>
        </form>


        <form id="form-resource-add-story" method="post" class="clearfix visible-modal" action="/resource/">

            <div class="modal-title">
                <h1>{{stringFormat (i18n "add") (i18n "Article")}}</h1>
                <div class="right">
                    <a href="https://github.com/hbz/oerworldmap/wiki/FAQs-for-OER-World-Map-editors" target="_blank">{{i18n "needHelp"}}</a>
                </div>
            </div>

            <div class="messages resource-form-widget"></div>

            {{> ResourceIndex/Article/edit.mustache}}

            <div class="pull-right">
                <button type="button" class="btn btn-default" data-dismiss="modal">{{i18n "cancel"}}</button>
                <button type="submit" class="btn btn-inverted">{{i18n "publish"}}</button>
            </div>
        </form>


        <form id="form-resource-add-action" method="post" class="clearfix visible-modal" action="/resource/">

            <div class="modal-title">
                <h1>{{stringFormat (i18n "add") (i18n "Action")}}</h1>
                <div class="right">
                    <a href="https://github.com/hbz/oerworldmap/wiki/FAQs-for-OER-World-Map-editors" target="_blank">{{i18n "needHelp"}}</a>
                </div>
            </div>

            <div class="messages resource-form-widget"></div>

            {{> ResourceIndex/Action/edit.mustache}}

            <div class="alert alert-info clearfix">
                <p>
                    {{{i18n "ResourceIndex.index.agreeMessage"}}}
                </p>
                <div class="pull-right">
                    <button type="button" class="btn btn-default" data-dismiss="modal">{{i18n "cancel"}}</button>
                    <button type="submit" class="btn btn-inverted">{{i18n "publish"}}</button>
                </div>
            </div>
        </form>


        <form id="form-resource-add-person" method="post" class="clearfix visible-modal" action="/user/">

            <div class="modal-title">
                <h1>{{stringFormat (i18n "add") (i18n "Person")}}</h1>
                <div class="right">
                    <a href="https://github.com/hbz/oerworldmap/wiki/FAQs-for-OER-World-Map-editors" target="_blank">{{i18n "needHelp"}}</a>
                </div>
            </div>

            <div class="messages resource-form-widget"></div>

            {{> ResourceIndex/Person/edit.mustache}}

            <div class="alert alert-info clearfix">
                <p>
                    {{{i18n "ResourceIndex.index.agreeMessage"}}}
                </p>
                <div class="pull-right">
                    <button type="button" class="btn btn-default" data-dismiss="modal">{{i18n "cancel"}}</button>
                    <button type="submit" class="btn btn-inverted">{{i18n "publish"}}</button>
                </div>
            </div>
        </form>


        <form id="form-resource-add-event" method="post" class="clearfix visible-modal" action="/resource/">

            <div class="modal-title">
                <h1>{{stringFormat (i18n "add") (i18n "Event")}}</h1>
                <div class="right">
                    <a href="https://github.com/hbz/oerworldmap/wiki/FAQs-for-OER-World-Map-editors" target="_blank">{{i18n "needHelp"}}</a>
                </div>
            </div>

            <div class="messages resource-form-widget"></div>

            {{> ResourceIndex/Event/edit.mustache}}

            <div class="alert alert-info clearfix">
                <p>
                    {{{i18n "ResourceIndex.index.agreeMessage"}}}
                </p>
                <div class="pull-right">
                    <button type="button" class="btn btn-default" data-dismiss="modal">{{i18n "cancel"}}</button>
                    <button type="submit" class="btn btn-inverted">{{i18n "publish"}}</button>
                </div>
            </div>
        </form>

        <form id="form-resource-add-webpage" method="post" class="clearfix visible-modal" action="/resource/">

            <div class="modal-title">
                <h1>{{stringFormat (i18n "add") (i18n "WebPage")}}</h1>
                <div class="right">
                    <a href="https://github.com/hbz/oerworldmap/wiki/FAQs-for-OER-World-Map-editors" target="_blank">{{i18n "needHelp"}}</a>
                </div>
            </div>

            <div class="messages resource-form-widget"></div>

            {{> ResourceIndex/WebPage/edit.mustache}}

            <div class="alert alert-info clearfix">
                <p>
                    {{{i18n "ResourceIndex.index.agreeMessage"}}}
                </p>
                <div class="pull-right">
                    <button type="button" class="btn btn-default" data-dismiss="modal">{{i18n "cancel"}}</button>
                    <button type="submit" class="btn btn-inverted">{{i18n "publish"}}</button>
                </div>
            </div>
        </form>

        <form id="form-resource-add-product" method="post" class="clearfix visible-modal" action="/resource/">

            <div class="modal-title">
                <h1>{{stringFormat (i18n "add") (i18n "Product")}}</h1>
                <div class="right">
                    <a href="https://github.com/hbz/oerworldmap/wiki/FAQs-for-OER-World-Map-editors" target="_blank">{{i18n "needHelp"}}</a>
                </div>
            </div>

            <div class="messages resource-form-widget"></div>

            {{> ResourceIndex/Product/edit.mustache}}

            <div class="alert alert-info clearfix">
                <p>
                    {{{i18n "ResourceIndex.index.agreeMessage"}}}
                </p>
                <div class="pull-right">
                    <button type="button" class="btn btn-default" data-dismiss="modal">{{i18n "cancel"}}</button>
                    <button type="submit" class="btn btn-inverted">{{i18n "publish"}}</button>
                </div>
            </div>
        </form>

    </div>

{{/if}}

{{#scope.iso3166}}

    <div class="visible-scope" data-app="scope">

        <h2>{{i18n alpha-2 bundle="iso3166-1-alpha-2"}}</h2>

        <section>

            <h4 class="section-head">
                <a role="button" data-toggle="collapse" href="#country-champion">
                    {{i18n "CountryIndex.read.countryChampion" bundle="ui"}}
                </a>
            </h4>

            <div id="country-champion" class="section-body clearfix collapse in"><div class="inner">

                {{#if champions}}

                    {{#champions}}
                        {{#about}}

                            <div class="user">

                                {{#image}}
                                    <a href="/resource/{{@id}}" class="avatar" style="background-image: url({{.}});">
                                        <img src="{{.}}" />
                                    </a>
                                {{/image}}
                                {{^image}}
                                    <div class="avatar placeholder-image-qmark"></div>
                                {{/image}}

                                <div class="text">

                                    <a href="/resource/{{@id}}">
                                        {{#localized this.displayName language=@root.language}}
                                            {{[@value]}}
                                        {{else}}
                                            {{#localized name language=@root.language}}
                                                {{[@value]}}
                                            {{else}}
                                                {{[@id]}}
                                            {{/localized}}
                                        {{/localized}}
                                    </a>

                                    <br/>

                                    <a href="mailto:{{{obfuscate email}}}">{{{obfuscate email}}}</a>

                                </div>

                            </div>

                        {{/about}}
                    {{/champions}}

                {{else}}

                    <div class="user">

                        <div class="avatar placeholder-image-qmark"></div>

                        <div class="text">
                            {{{stringFormat (i18n "CountryIndex.read.noChampion" bundle="ui") (i18n alpha-2 bundle="iso3166-1-alpha-2")}}}
                        </div>

                    </div>

                {{/if}}

            </div></div>

        </section>

        {{#if reports}}

            <section>

                <h4 class="section-head">
                    <a role="button" data-toggle="collapse" href="#country-reports" class="collapsed">
                        {{i18n "CountryIndex.read.countryReports" bundle="ui"}}
                    </a>
                </h4>

                <div id="country-reports" class="section-body collapse"><div class="inner">
                    <ul class="resource-list">
                        {{#reports}}
                            {{#about}}
                                <li about="{{@id}}">
                                    {{>ResourceIndex/link.mustache}}
                                </li>
                            {{/about}}
                        {{/reports}}
                    </ul>
                </div></div>

            </section>

        {{/if}}

        <section>

            <h4 class="section-head">
                <a role="button" data-toggle="collapse" href="#country-statistics" class="collapsed">
                    {{i18n "CountryIndex.read.statistics" bundle="ui"}}
                </a>
            </h4>

            <div id="country-statistics" class="section-body collapse"><div class="inner">

                <script type="application/ld+json" id="json-aggregations">
                    {{json countryAggregation}}
                </script>

                {{#countryAggregation.[about.location.address.addressCountry].buckets}}
                    <table class="statistics-table">
                        {{#by_type.buckets}}
                            <tr>
                                <td>{{doc_count}}</td>
                                <td>{{getIcon key}}
                                    <a href="?filter.about.@type={{key}}">{{i18n key}}</a>
                                </td>
                            </tr>
                        {{/by_type.buckets}}
                    </table>
                {{/countryAggregation.[about.location.address.addressCountry].buckets}}

            </div></div>

        </section>

    </div>

{{/scope.iso3166}}

<div id="filter-container"{{#if embed}} class="hidden"{{/if}}>

    <form id="form-resource-filter" class="app-hidden" action="{{#if scope.iso3166.[alpha-2]}}/country/{{scope.iso3166.[alpha-2]}}{{else}}/resource/{{/if}}">

        <script type="application/ld+json" id="json-filters">
            {{json scope.resources.filters}}
        </script>

        <script type="application/ld+json" id="json-aggregations">
            {{json scope.resources.aggregations}}
        </script>

        <div class="column-section">
            <div id="search">
                <input type="text" name="q" value="{{scope.resources.query}}" placeholder="{{i18n 'ResourceIndex.index.searchMap'}} ...">
                <button class="btn" type="submit"><i class="fa fa-search"></i></button>
            </div>
        </div>

        <div class="column-section bg-blue-paler">

        <span class="text-muted">{{i18n "ResourceIndex.index.filterBy"}}:</span>

        {{#each scope.resources.aggregations}}

            <h2 data-filter-name="{{@key}}">{{i18n (getField [@key])}}</h2>
            <ul class="color-scheme-text layout-typo-small">
                {{#buckets}}
                    <li>
                        <label class="resource-filter">
                            {{#unless key_as_string}}
                                {{#ifIn [@key] key scope.resources.filters}}
                                    <input type="checkbox" checked class="filter" name="filter.{{../[@key]}}" value="{{key}}">
                                {{ else }}
                                    <input type="checkbox" class="filter" name="filter.{{../[@key]}}" value="{{key}}">
                                {{/ifIn}}
                                <span class="label">{{i18n key bundle=(getBundle (getField ../[@key]))}}</span> ({{doc_count}})
                            {{ else }}
                                {{#ifIn [@key] key_as_string scope.resources.filters}}
                                    <input type="checkbox" checked class="filter" name="filter.{{../[@key]}}" value="{{key_as_string}}">
                                {{ else }}
                                    <input type="checkbox" class="filter" name="filter.{{../[@key]}}" value="{{key_as_string}}">
                                {{/ifIn}}
                                <span class="label">{{key_as_string}}</span> ({{doc_count}})
                            {{/unless}}
                        </label>
                    </li>
                {{/buckets}}
            </ul>

        {{/each}}

        </div>

    </form>

</div>

<div class="{{#unless embed}}list-statistics-container{{/unless}} floating-hidden">

    <div class="p filter-state visible-print">
        {{i18n "ResourceIndex.index.showingEntities"}}

        {{#if scope.resources.query}}
            {{i18n "ResourceIndex.index.withMatch"}}
            "{{scope.resources.searchTerms}}"
            <span class="comma">{{i18n "ResourceIndex.index.and"}}</span>
        {{/if}}

        {{#if scope.resources.filters}}
            {{i18n "ResourceIndex.index.where"}}
            {{#each scope.resources.filters}}
                <span class="field">
                    <strong>{{i18n (getField [@key])}}</strong> is
                    {{#each .}}
                        <em>{{i18n . bundle=(getBundle (getField ../[@key]))}}</em> <span class="comma">{{i18n "ResourceIndex.index.or"}}</span>
                    {{/each}}
                </span>
                <span class="comma">{{i18n "ResourceIndex.index.and"}}</span>
            {{/each}}
        {{/if}}
    </div>

    <div class="geo-filtered-list-control{{#if embed}} hidden{{/if}}"></div>

    <div class="p clearfix">

        <div class="pull-left{{#if embed}} hidden{{/if}}">
            <span class="badge total-items">{{scope.resources.totalItems}}</span> {{i18n "ResourceIndex.index.results"}}
        </div>

        <div class="pull-right{{#if embed}} hidden{{/if}}">

            <ul class="resource-controls">

                <li class="dropdown">
                    <button type="button" class="icon-btn" data-toggle="dropdown" title="{{i18n 'shareAndExport'}}">
                        <i class="fa fa-gear"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-right">
                        <li><a href="#resource-share-list" data-app="to-modal-and-attach-behaviours">{{i18n "share"}} <i class="fa fa-fw fa-share"></i></a></li>
                        <li><a href="#resource-export-list" data-app="to-modal-and-attach-behaviours">{{i18n "export"}} <i class="fa fa-fw fa-arrow-circle-o-right"></i></a></li>
                        <li><button data-behaviour="print-index">{{i18n "print"}} <i class="fa fa-fw fa-file-text-o"></i></button></li>
                    </ul>
                </li>

            </ul>

        </div>

    </div>

    <div>

        {{#showCalendar scope}}

            {{>ResourceIndex/calendar.mustache}}

        {{else}}

            {{>ResourceIndex/list.mustache}}

        {{/showCalendar}}

    </div>


</div>

<div data-dont-behave>

    {{> share.mustache type="list" url=@root.requestUri name=""}}

    {{> export.mustache type="list" url=@root.requestUri}}

</div>
