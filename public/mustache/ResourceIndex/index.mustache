{{#if permissions.add}}

    <div data-dont-behave>

        <form id="form-resource-add-service" method="post" class="clearfix visible-modal" action="/resource/">

            <div class="modal-title">
                <h1>Add Service</h1>
                <div class="right">
                    <a href="https://github.com/hbz/oerworldmap/wiki/FAQs-for-OER-World-Map-editors" target="_blank">Need Help?</a>
                </div>
            </div>

            <div class="messages resource-form-widget"></div>

            {{> ResourceIndex/Service/edit.mustache}}

            <div class="pull-right resource-form-top-padding">
                <button type="button" class="btn btn-default" data-dismiss="modal">Quit</button>
                <button type="submit" class="btn btn-inverted">Save Changes</button>
            </div>
        </form>


        <form id="form-resource-add-organization" method="post" class="clearfix visible-modal" action="/resource/">

            <div class="modal-title">
                <h1>Add Organization</h1>
                <div class="right">
                    <a href="https://github.com/hbz/oerworldmap/wiki/FAQs-for-OER-World-Map-editors" target="_blank">Need Help?</a>
                </div>
            </div>

            <div class="messages resource-form-widget"></div>

            {{> ResourceIndex/Organization/edit.mustache}}

            <div class="pull-right resource-form-top-padding">
                <button type="button" class="btn btn-default" data-dismiss="modal">Quit</button>
                <button type="submit" class="btn btn-inverted">Save Changes</button>
            </div>
        </form>


        <form id="form-resource-add-story" method="post" class="clearfix visible-modal" action="/resource/">

            <div class="modal-title">
                <h1>Add Story</h1>
                <div class="right">
                    <a href="https://github.com/hbz/oerworldmap/wiki/FAQs-for-OER-World-Map-editors" target="_blank">Need Help?</a>
                </div>
            </div>

            <div class="messages resource-form-widget"></div>

            {{> ResourceIndex/Article/edit.mustache}}

            <div class="pull-right resource-form-top-padding">
                <button type="button" class="btn btn-default" data-dismiss="modal">Quit</button>
                <button type="submit" class="btn btn-inverted">Save Changes</button>
            </div>
        </form>


        <form id="form-resource-add-action" method="post" class="clearfix visible-modal" action="/resource/">

            <div class="modal-title">
                <h1>Add Project</h1>
                <div class="right">
                    <a href="https://github.com/hbz/oerworldmap/wiki/FAQs-for-OER-World-Map-editors" target="_blank">Need Help?</a>
                </div>
            </div>

            <div class="messages resource-form-widget"></div>

            {{> ResourceIndex/Action/edit.mustache}}

            <div class="pull-right resource-form-top-padding">
                <button type="button" class="btn btn-default" data-dismiss="modal">Quit</button>
                <button type="submit" class="btn btn-inverted">Save Changes</button>
            </div>
        </form>


        <form id="form-resource-add-person" method="post" class="clearfix visible-modal" action="/user/">

            <div class="modal-title">
                <h1>Add Person</h1>
                <div class="right">
                    <a href="https://github.com/hbz/oerworldmap/wiki/FAQs-for-OER-World-Map-editors" target="_blank">Need Help?</a>
                </div>
            </div>

            <div class="messages resource-form-widget"></div>

            {{> ResourceIndex/Person/edit.mustache}}

            <div class="pull-right resource-form-top-padding">
                <button type="button" class="btn btn-default" data-dismiss="modal">Quit</button>
                <button type="submit" class="btn btn-inverted">Save Changes</button>
            </div>
        </form>


        <form id="form-resource-add-event" method="post" class="clearfix visible-modal" action="/resource/">

            <div class="modal-title">
                <h1>Add Event</h1>
                <div class="right">
                    <a href="https://github.com/hbz/oerworldmap/wiki/FAQs-for-OER-World-Map-editors" target="_blank">Need Help?</a>
                </div>
            </div>

            <div class="messages resource-form-widget"></div>

            {{> ResourceIndex/Event/edit.mustache}}

            <div class="pull-right resource-form-top-padding">
                <button type="submit" class="btn btn-default" data-dismiss="modal">Quit</button>
                <button type="submit" class="btn btn-inverted">Save Changes</button>
            </div>
        </form>

        <form id="form-resource-add-webpage" method="post" class="clearfix visible-modal" action="/resource/">

            <div class="modal-title">
                <h1>Add Bookmark</h1>
                <div class="right">
                    <a href="https://github.com/hbz/oerworldmap/wiki/FAQs-for-OER-World-Map-editors" target="_blank">Need Help?</a>
                </div>
            </div>

            <div class="messages resource-form-widget"></div>

            {{> ResourceIndex/WebPage/edit.mustache}}

            <div class="pull-right resource-form-top-padding">
                <button type="submit" class="btn btn-default" data-dismiss="modal">Quit</button>
                <button type="submit" class="btn btn-inverted">Save Changes</button>
            </div>
        </form>

    </div>

{{/if}}

<div id="filter-container">

    <form id="form-resource-filter" class="app-hidden" action="/resource/">

        <script type="application/ld+json" id="json-filters">
            {{json scope.resources.filters}}
        </script>

        <script type="application/ld+json" id="json-aggregations">
            {{json scope.resources.aggregations}}
        </script>

        <div class="column-section">
            <div id="search">
                <input type="text" name="q" value="{{scope.resources.searchTerms}}" placeholder="Search the map ...">
                <button class="btn" type="submit"><i class="fa fa-search"></i></button>
            </div>
        </div>

        <div class="column-section bg-blue-paler">

        <span class="text-muted">Filter by:</span>

        {{#each scope.resources.aggregations}}

            <h2 data-filter-name="{{@key}}">{{i18n (getField [@key])}}</h2>
            <ul class="color-scheme-text layout-typo-small">
                {{#buckets}}
                    <li>
                        <label class="resource-filter">
                            {{#unless key_as_string}}
                                {{#ifIn [@key] key scope.resources.filters}}
                                    <input type="checkbox" checked class="filter" name="filter.{{../[@key]}}" value="{{key}}">
                                {{ else }}
                                    <input type="checkbox" class="filter" name="filter.{{../[@key]}}" value="{{key}}">
                                {{/ifIn}}
                                <span class="label">{{i18n key bundle=(getBundle (getField ../[@key]))}}</span> ({{doc_count}})
                            {{ else }}
                                {{#ifIn [@key] key_as_string scope.resources.filters}}
                                    <input type="checkbox" checked class="filter" name="filter.{{../[@key]}}" value="{{key_as_string}}">
                                {{ else }}
                                    <input type="checkbox" class="filter" name="filter.{{../[@key]}}" value="{{key_as_string}}">
                                {{/ifIn}}
                                <span class="label">{{key_as_string}}</span> ({{doc_count}})
                            {{/unless}}
                        </label>
                    </li>
                {{/buckets}}
            </ul>

        {{/each}}

        </div>

    </form>

</div>


<div class="list-statistics-container floating-hidden" data-behaviour="geoFilteredList">

    <div class="p filter-state visible-print">
        Showing entities

        {{#if scope.resources.searchTerms}}
            which match
            "{{scope.resources.searchTerms}}"
            <span class="comma">and</span>
        {{/if}}

        {{#if scope.resources.filters}}
            where
            {{#each scope.resources.filters}}
                <span class="field">
                    <strong>{{i18n (getField [@key])}}</strong> is
                    {{#each .}}
                        <em>{{i18n . bundle=(getBundle (getField ../[@key]))}}</em> <span class="comma">or</span>
                    {{/each}}
                </span>
                <span class="comma">and</span>
            {{/each}}
        {{/if}}
    </div>

    <div class="geo-filtered-list-control"></div>

    <div class="p clearfix">

        <div class="pull-left">
            <span class="badge total-items">{{scope.resources.totalItems}}</span> results
        </div>

        <div class="pull-right">

            <ul class="resource-controls">

                <li class="dropdown">
                    <button type="button" class="icon-btn" data-toggle="dropdown" title="Share and Export">
                        <i class="fa fa-gear"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-right">
                        <li><a href="#resource-share-list" data-app="to-modal-and-attach-behaviours">Share <i class="fa fa-fw fa-share"></i></a></li>
                        <li><a href="#resource-export-list" data-app="to-modal-and-attach-behaviours">Export <i class="fa fa-fw fa-arrow-circle-o-right"></i></a></li>
                        <li><button data-behaviour="print-index">Print <i class="fa fa-fw fa-file-text-o"></i></button></li>
                    </ul>
                </li>

            </ul>

        </div>

    </div>

    <div>

        {{#showCalendar scope}}

            {{>ResourceIndex/calendar.mustache}}

        {{else}}

            {{>ResourceIndex/list.mustache}}

        {{/showCalendar}}

    </div>


</div>

<div data-dont-behave>

    {{> share.mustache type="list" url=@root.requestUri name=""}}

    {{> export.mustache type="list" url=@root.requestUri}}

</div>
