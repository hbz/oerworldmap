language: scala
scala:
  - 2.11.7
jdk: oraclejdk8
sudo: false
cache:
  directories:
  - $HOME/.ivy2/cache
  - $HOME/.sonar/cache
before_install:
  - curl https://download.elastic.co/elasticsearch/release/org/elasticsearch/distribution/tar/elasticsearch/2.4.1/elasticsearch-2.4.1.tar.gz | tar xz --directory=$HOME
  - "echo \"script.inline: on\" >> $HOME/elasticsearch-2.4.1/config/elasticsearch.yml"
  - $HOME/elasticsearch-2.4.1/bin/plugin install 'http://repo1.maven.org/maven2/org/xbib/elasticsearch/plugin/elasticsearch-plugin-bundle/2.4.1.0/elasticsearch-plugin-bundle-2.4.1.0-plugin.zip'
  - $HOME/elasticsearch-2.4.1/bin/elasticsearch --daemonize --path.data /tmp && sleep 20s
install:
  - npm install
  - cd node/json-frame/ && npm install && cd ../..
before_script:
  - cp conf/travis.conf conf/test.conf
  - (node node/json-frame/frame.js 8080 conf/context.json https://oerworldmap.org/assets/json/context.json &) && sleep 5s
script:
  - mvn clean org.jacoco:jacoco-maven-plugin:prepare-agent package sonar:sonar
addons:
  sonarqube:
    token:
      secure: "O3mnIElHHjHfG83ihUhxxq9oHDtZW9rh9rnMuw6zvHl/QC0zwEMNTykwZcNP24pNk4+sMLd8LyfRIRm/GRPAlakCAbCktFbkOHsm4Abk/s4jbiNLlV/WVn3N9zCDCE359zrDPSw9GIsgTnM015ZiATO+2zCpt26VFKLJrWHofuA="
    github:
      secure: "LqhCTSEh59uYgNgkOPgNIOJQ71gN+pt5yKP5qXFHdd0CsI03xDRgp8stmgjWgl7pBQ7Ti6gm6kdPbcikvGePC9Gj++6jsFrLDyFDm9GjqcbOGSGZpQfXK0NRzmyt4NmGBCVzmDtwMQfs/ZTvBhWM9epgGL2CZQH/bH30x71cptQ="
branches:
  only:
    - master
